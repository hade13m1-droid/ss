<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Hade Admin Panel</title>
  <style>
    :root{--bg:#080b18;--panel:rgba(11,16,28,.78);--line:rgba(255,255,255,.14);--text:#f5f7ff;--muted:#b5bfdc;--accent:#8e77ff}
    *{box-sizing:border-box} body{margin:0;min-height:100vh;font-family:Inter,system-ui;color:var(--text);background:radial-gradient(circle at top,#1b2050 0,#090d1d 60%)}
    .shell{width:min(1050px,100%);margin:1rem auto;padding:1rem;border:1px solid var(--line);border-radius:22px;background:linear-gradient(130deg,rgba(142,119,255,.14),rgba(142,119,255,.01)),var(--panel)}
    .grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:.55rem} .full{grid-column:1/-1}
    label{display:grid;gap:.3rem;color:var(--muted);font-size:.9rem} input,textarea{border-radius:12px;border:1px solid var(--line);background:rgba(255,255,255,.03);color:var(--text);padding:.6rem .68rem;font:inherit}
    .actions,.upload-row{display:flex;flex-wrap:wrap;gap:.5rem}.btn{border:1px solid var(--line);border-radius:999px;padding:.45rem .8rem;background:rgba(255,255,255,.03);color:var(--text);text-decoration:none;cursor:pointer}
    .status{min-height:1.2em;color:#96ffd0}.inbox{margin-top:1rem;border-top:1px solid var(--line);padding-top:.9rem}.messages{display:grid;gap:.5rem;margin-top:.55rem}
    .message{border:1px solid var(--line);border-radius:12px;padding:.6rem;background:rgba(255,255,255,.03)} .top{display:flex;justify-content:space-between;gap:.5rem;font-size:.83rem;color:var(--muted)}
    .preview{width:90px;height:90px;border-radius:12px;object-fit:cover;border:1px solid var(--line)} @media (max-width:760px){.grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <main class="shell">
    <h1>‚öôÔ∏è Admin Panel</h1>
    <p class="status" id="status"></p>
    <form id="admin-form" class="grid">
      <label>Name <input id="name" type="text" /></label>
      <label>Availability <input id="availability" type="text" /></label>
      <label>Place <input id="place" type="text" /></label>
      <label>Accent Color <input id="accentColor" type="text" placeholder="#8e77ff" /></label>
      <label class="full">Description <textarea id="description" rows="3"></textarea></label>
      <label>Music URL <input id="music" type="url" /></label>
      <label>PFP URL <input id="pfp" type="text" /></label>
      <div class="full upload-row">
        <img id="pfp-preview" class="preview" src="/uploads/default-pfp.svg" alt="pfp preview" />
        <input id="pfp-file" type="file" accept="image/*" />
        <button id="upload-pfp" class="btn" type="button">Upload PFP</button>
      </div>

      <label class="full">Skills (comma separated)<input id="skills" type="text" /></label>
      <label class="full">Links JSON<textarea id="links" rows="5"></textarea></label>
      <label class="full">Projects JSON (supports image field)<textarea id="projects" rows="7"></textarea></label>
      <div class="full upload-row">
        <input id="project-file" type="file" accept="image/*" />
        <button id="upload-project" class="btn" type="button">Upload Project Image</button>
        <input id="project-image-output" type="text" placeholder="Uploaded project image URL appears here" />
      </div>

      <div class="full actions">
        <button class="btn" type="submit">Save</button>
        <button id="reload" class="btn" type="button">Reload</button>
        <button id="refresh" class="btn" type="button">Refresh Inbox</button>
        <a class="btn" href="/">Open Portfolio</a>
      </div>
    </form>

    <section class="inbox">
      <h2>üì® Messages</h2>
      <div id="messages" class="messages"></div>
    </section>
  </main>

  <script>
    const byId=(id)=>document.getElementById(id);
    async function api(path,opts){const r=await fetch(path,{...opts,headers:{...(opts&&opts.headers||{})}});const ct=r.headers.get('content-type')||'';const d=ct.includes('json')?await r.json():{};if(!r.ok)throw new Error(d.error||'Request failed');return d}
    function setStatus(text,ok=true){const s=byId('status');s.style.color=ok?'#96ffd0':'#ff8ea8';s.textContent=text;}
    function fill(cfg){byId('name').value=cfg.name||'';byId('availability').value=cfg.availability||'';byId('place').value=cfg.place||'';byId('accentColor').value=cfg.accentColor||'';byId('description').value=cfg.description||'';byId('music').value=cfg.music||'';byId('pfp').value=cfg.pfp||'';byId('pfp-preview').src=cfg.pfp||'/uploads/default-pfp.svg';byId('skills').value=(cfg.skills||[]).join(', ');byId('links').value=JSON.stringify(cfg.links||[],null,2);byId('projects').value=JSON.stringify(cfg.projects||[],null,2)}
    function collect(){return{name:byId('name').value.trim(),availability:byId('availability').value.trim(),place:byId('place').value.trim(),accentColor:byId('accentColor').value.trim(),description:byId('description').value.trim(),music:byId('music').value.trim(),pfp:byId('pfp').value.trim(),skills:byId('skills').value.split(',').map(x=>x.trim()).filter(Boolean),links:JSON.parse(byId('links').value),projects:JSON.parse(byId('projects').value)}}
    async function upload(fileInput,outputInput){const f=fileInput.files&&fileInput.files[0]; if(!f){throw new Error('Choose a file first');} const fd=new FormData(); fd.append('file',f); const res=await fetch('/api/upload',{method:'POST',body:fd}); const d=await res.json(); if(!res.ok)throw new Error(d.error||'Upload failed'); outputInput.value=d.url; return d.url;}
    async function loadAll(){const cfg=await fetch('/api/config').then(r=>r.json()); fill(cfg); const msgs=await fetch('/api/messages').then(r=>r.json()); byId('messages').innerHTML=msgs.map(m=>`<article class="message"><div class="top"><span><b>${m.name}</b> ‚Ä¢ ${m.email}</span><span>${new Date(m.created_at).toLocaleString()}</span></div><p>${m.message}</p></article>`).join('') || '<p>No messages yet.</p>'}

    byId('upload-pfp').onclick=async()=>{try{const url=await upload(byId('pfp-file'),byId('pfp')); byId('pfp').value=url;byId('pfp-preview').src=url;setStatus('PFP uploaded. Save config now.');}catch(e){setStatus(e.message,false)}};
    byId('upload-project').onclick=async()=>{try{const url=await upload(byId('project-file'),byId('project-image-output')); setStatus('Project image uploaded. Paste URL into projects JSON image field.');byId('project-image-output').value=url;}catch(e){setStatus(e.message,false)}};
    byId('admin-form').onsubmit=async(e)=>{e.preventDefault();try{await fetch('/api/config',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(collect())}).then(async r=>{const d=await r.json();if(!r.ok)throw new Error(d.error||'save failed')});setStatus('Saved live config ‚úÖ');}catch(err){setStatus(err.message,false)}};
    byId('reload').onclick=()=>loadAll().then(()=>setStatus('Reloaded')).catch(e=>setStatus(e.message,false));
    byId('refresh').onclick=()=>loadAll().then(()=>setStatus('Inbox refreshed')).catch(e=>setStatus(e.message,false));
    loadAll().catch(e=>setStatus(e.message,false));
  </script>
</body>
</html>
